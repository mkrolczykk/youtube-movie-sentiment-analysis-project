# Docker Compose - Base Configuration
# Usage: docker compose -f docker-compose.yml -f docker-compose.[dev|prod].yml up

services:
  sentiment-app:
    build:
      context: .
      dockerfile: Dockerfile
    image: youtube-sentiment-analysis:latest
    container_name: sentiment-analysis

    # Environment variables
    environment:
      - STREAMLIT_SERVER_PORT=8501
      - STREAMLIT_SERVER_ADDRESS=0.0.0.0
      - STREAMLIT_SERVER_HEADLESS=true
      - STREAMLIT_BROWSER_GATHER_USAGE_STATS=false
      - TRANSFORMERS_CACHE=/app/.cache/huggingface
      - HF_HOME=/app/.cache/huggingface

    # Port mapping
    ports:
      - "${APP_PORT:-8501}:8501"

    # Volumes for model caching (persists between container restarts)
    volumes:
      - model-cache:/app/.cache/huggingface

    # Health check
    healthcheck:
      test: [ "CMD", "python", "/app/scripts/healthcheck.py" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

    # Restart policy
    restart: unless-stopped

    # Network
    networks:
      - sentiment-network

# Named volumes
volumes:
  model-cache:
    driver: local

# Networks
networks:
  sentiment-network:
    driver: bridge
